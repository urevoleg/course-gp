# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

- üí£ [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 1 (search_path)](https://github.com/urevoleg/course-gp/blob/main/chapter2/README.md#%EF%B8%8F-–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ-–∑–∞–¥–∞–Ω–∏–µ-1)
- üí£ [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 2 (compression)](https://github.com/urevoleg/course-gp/blob/main/chapter2/README.md#%EF%B8%8F-–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ-–∑–∞–¥–∞–Ω–∏–µ-2-–∞–ª–≥–æ—Ä–∏—Ç–º—ã-—Å–∂–∞—Ç–∏—è)
- üí£ [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 3 (partition)](https://github.com/urevoleg/course-gp/blob/main/chapter2/README.md#%EF%B8%8F-–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ-–∑–∞–¥–∞–Ω–∏–µ-3-–ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ)
- üí£ [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 4 (partition manipuilation)](https://github.com/urevoleg/course-gp/blob/main/chapter2/README.md#%EF%B8%8F-–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ-–∑–∞–¥–∞–Ω–∏–µ-4-–º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏-—Å-–ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏)

[üëâ –ö –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](https://github.com/urevoleg/course-gp/blob/main/chapter3/README.md#–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏-–∑–∞–ø—Ä–æ—Å–æ–≤)

## –ö–∞–∫ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∑–∞–ø—Ä–æ—Å—ã –≤ Greenplum

–°–µ—Ä–≤–∏—Å –ø–æ —Ä–∞—Å–∫—É—Ä–∏–≤–∞–Ω–∏—é –ø–ª–∞–Ω–æ–≤ –∑–∞–ø—Ä–æ—Å–∞ [link](https://demo-explain.tensor.ru/plan/)

**–ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å** ‚Äî –∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–µ–±—É–µ—Ç –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω–æ –±–æ–ª—å—à–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ (–≤—Ä–µ–º—è, CPU, RAM, –¥–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ), —á–µ–º –º–æ–≥ –±—ã.

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞** ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–∞ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–µ—Å—Å–∏–∏) –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏
—É–º–µ–Ω—å—à–µ–Ω–∏—è –∑–∞—Ç—Ä–∞—á–µ–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –°–£–ë–î.

**–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å** ‚Äî –∑–∞–ø—Ä–æ—Å, –ª—é–±–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º–æ–º—É —É–º–µ–Ω—å—à–µ–Ω–∏—é –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã –∏–ª–∏ —É—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞.

**–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤** ‚Äî –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º–∞ —è–¥—Ä–∞ Greenplum, –∫–æ—Ç–æ—Ä–∞—è –ø–æ —Ç–µ–∫—Å—Ç—É –∑–∞–ø—É—Å–∫–∞ —Å—Ç—Ä–æ–∏—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π. 
–ü–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∑–∞–ø—É—Å–∫–æ–º SQL-–∑–∞–ø—Ä–æ—Å–∞. –≠—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –°–£–ë–î –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç—Ä–µ–±—É–µ–º–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

–î–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–ª–∞–Ω–∞ –∑–∞–ø—Ä–æ—Å–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
* C—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –Ω–∏—Ö –ø–æ –∫–ª–∞—Å—Ç–µ—Ä—É.
* –ù–∞–ª–∏—á–∏–µ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤.
* –û—Å–æ–±—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ ‚Äî —Ç–∞–±–ª–∏—á–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.

**–ü–ª–∞–Ω –∑–∞–ø—Ä–æ—Å–∞** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º –ø–æ SQL-–∑–∞–ø—Ä–æ—Å—É –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –°–£–ë–î, –∑–∞–ø—É—Å–∫ –∫–æ—Ç–æ—Ä–æ–π –∏ –µ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–ª–∞–Ω –∑–∞–ø—Ä–æ—Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º –¥–æ—å–±–∞–≤–∏—Ç—å –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `EXPLAIN`:

```sql
EXPLAIN SELECT * FROM table JOIN dict USING (id);
```

### ‚úçÔ∏è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 1: –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –∑–∞–ø—Ä–æ—Å–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –¥–≤–µ –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã table1 –∏ table2 –≤ —Å—Ö–µ–º–µ public.

```sql
DROP TABLE IF EXISTS table1;
CREATE TABLE table1 (id int, dt date) 
DISTRIBUTED BY (id);

DROP TABLE IF EXISTS table2;
CREATE TABLE table2 (id int, val text) 
DISTRIBUTED BY (id);
```

2. –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–º–∏

```sql
INSERT INTO table1 (id, dt)
  (
    SELECT 
      id, 
      '2023-06-01'::date + interval '1 month' * (id%10) 
    FROM generate_series(1,100) as id
  );

INSERT INTO table2 (id, val)
  (
    SELECT 
      id, 
      'ab'::text || chr(ascii('a') + mod(id,3))::text 
    FROM generate_series(1,100) as id
  );
```

3. –°–º–æ—Ç—Ä–∏–º –ø–ª–∞–Ω –∑–∞–ø—Ä–æ—Å–∞

```sql
EXPLAIN 
SELECT *
FROM 
  (SELECT * FROM table1 WHERE table1.dt='2023-08-01') AS t1
  INNER JOIN
  (SELECT * FROM table2) AS t2
    ON t1.id = t2.id
WHERE t2.val='abc';
```

![explain_example.png](..%2Fimg%2Fexplain_example.png)

[üëâ –ö –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](https://github.com/urevoleg/course-gp/blob/main/chapter3/README.md#–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏-–∑–∞–ø—Ä–æ—Å–æ–≤)

-----------------------------------

–î–æ–ø–∏–Ω—Ñ–∞ –≤ –ø–ª–∞–Ω–µ –∑–∞–ø—Ä–æ—Å–∞:
- **–°—Ç–æ–∏–º–æ—Å—Ç—å, –∏–ª–∏ –∑–∞—Ç—Ä–∞—Ç—ã (cost)**, ‚Äî –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–∞—è –≤–µ–ª–∏—á–∏–Ω–∞ –≤ —É—Å–ª–æ–≤–Ω—ã—Ö ¬´–ø–æ–ø—É–≥–∞—è—Ö¬ª, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∏–ª–∏ –∑–∞—Ç—Ä–∞—Ç—ã —Ä–µ—Å—É—Ä—Å–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞.
- **–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π**, –≤–æ–∑–≤—Ä–∞—â—ë–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º (rows), ‚Äî –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –∑–∞–ø–∏—Å–µ–π.
- **–†–∞–∑–º–µ—Ä –∑–∞–ø–∏—Å–µ–π**, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º (width), ‚Äî —Ä–∞–∑–º–µ—Ä –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏ –≤ –±–∞–π—Ç–∞—Ö.
- **(–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞** (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞) ‚Äî –∞—Ç—Ä–∏–±—É—Ç—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞, –¥–µ—Ç–∞–ª–∏–∑–∏—Ä—É—é—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä –µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: –Ω–∞–ø—Ä–∏–º–µ—Ä, —É—Å–ª–æ–≤–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏–ª–∏ –∫–ª—é—á–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü.
- **(–î–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤) –°—Ä–µ–∑, –∏–ª–∏ —Å–ª–∞–π—Å (slice)**, ‚Äî —á–∞—Å—Ç—å –ø–ª–∞–Ω–∞ –∑–∞–ø—Ä–æ—Å–∞, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –µ–≥–æ —á–∞—Å—Ç–µ–π.

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `EXPLAIN` - —Å–∞–º –∑–∞–ø—Ä–æ—Å –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—ã –≤—ã–ø–æ–ª–Ω–µ–Ω –∑–∞–ø—Ä–æ—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
`EXPLAIN ANALYZE` - –µ–≥–æ –≤—ã–≤–æ–¥ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é