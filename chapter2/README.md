# –§–∏–∑–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö –∏ DDL

–ß–∞—Å—Ç—å 1:
- üí£ [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 1 (search_path)](https://github.com/urevoleg/course-gp/blob/main/chapter2/README.md#%EF%B8%8F-–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ-–∑–∞–¥–∞–Ω–∏–µ-1)
- üí£ [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 2 (compression)](https://github.com/urevoleg/course-gp/blob/main/chapter2/README.md#%EF%B8%8F-–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ-–∑–∞–¥–∞–Ω–∏–µ-2-–∞–ª–≥–æ—Ä–∏—Ç–º—ã-—Å–∂–∞—Ç–∏—è)
- üí£ [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 3 (partition)](https://github.com/urevoleg/course-gp/blob/main/chapter2/README.md#%EF%B8%8F-–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ-–∑–∞–¥–∞–Ω–∏–µ-3-–ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ)
- üí£ [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 4 (partition manipuilation)](https://github.com/urevoleg/course-gp/blob/main/chapter2/README.md#%EF%B8%8F-–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ-–∑–∞–¥–∞–Ω–∏–µ-4-–º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏-—Å-–ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏)

–ß–∞—Å—Ç—å 2:
- üí£ [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 5 (indexes)](https://github.com/urevoleg/course-gp/blob/main/chapter2/README.md#%EF%B8%8F-–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ-–∑–∞–¥–∞–Ω–∏–µ-5-–∏–Ω–¥–µ–∫—Å—ã)
- üí£ [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 2 (compression)](https://github.com/urevoleg/course-gp/blob/main/chapter2/README.md#%EF%B8%8F-–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ-–∑–∞–¥–∞–Ω–∏–µ-2-–∞–ª–≥–æ—Ä–∏—Ç–º—ã-—Å–∂–∞—Ç–∏—è)
- üí£ [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 3 (partition)](https://github.com/urevoleg/course-gp/blob/main/chapter2/README.md#%EF%B8%8F-–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ-–∑–∞–¥–∞–Ω–∏–µ-3-–ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ)
- üí£ [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 4 (partition manipuilation)](https://github.com/urevoleg/course-gp/blob/main/chapter2/README.md#%EF%B8%8F-–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ-–∑–∞–¥–∞–Ω–∏–µ-4-–º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏-—Å-–ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏)


## –°—É—â–Ω–æ—Å—Ç–∏

1. **–ò–Ω—Å—Ç–∞–Ω—Å** - –Ω–∞–±–æ—Ä –ø—Ä–æ–≥—Ä–∞–º–º, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å –ë–î
2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - –Ω–∞–±–æ—Ä —Ç–∞–±–ª–∏—Ü —Å –¥–∞–Ω–Ω—ã–º–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π, —Ñ—É–Ω–∫—Ü–∏–π –∏ –¥—Ä—É–≥–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤

–û–¥–∏–Ω –∏–Ω—Å—Ç–∞–Ω—Å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ë–î. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∏–∑ –æ–¥–Ω–æ–π –ë–î –≤ –¥—Ä—É–≥—É—é –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ

–°–∏–Ω—Ç–∞–∫—Å–∏—Å —Å–æ–∑–¥–∞–Ω–∏—è –Ω–µ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –æ—Ç Postgres

3. **–°—Ö–µ–º–∞** - –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏–º–µ–Ω, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã: —Ç–∞–±–ª–∏—Ü—ã, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è, —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö, —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
–ò–º–µ–Ω–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –æ–¥–Ω–æ–π —Å—Ö–µ–º–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã, –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ö–µ–º–∞—Ö –º–æ–≥—É—Ç –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏.
4. **–†–æ–ª—å** - —Å—É—â–Ω–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä–∞—è –º–æ–¥–µ—Ç –≤–ª–∞–¥–µ—Ç—å –æ–±—ä–µ–∫—Ç–∞–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –º–µ—Ç—å –µ—ë –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏. 
–†–æ–ª—å –º–æ–∂–µ—Ç —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å—Å—è –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –≥—Ä—É–ø–ø–∞ –∏–ª–∏ –æ–±–∞. –†–æ–ª–∏ —è–≤–ª—è—é—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ –¥–ª—è –≤—Å–µ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞

–ò–º–µ–Ω–∞ –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∫ —Ä–µ–≥–∏—Å—Ç—Ä—É: –æ–±—Ä–∞—â–µ–Ω–∏–µ

```sql
SELECT * FROM table; —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ SELECT * FROM TABLE;
```
–ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–æ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, —Ç–æ –∏–º–µ–Ω–∞ –∑–∞–∫–ª—é—á–∞—é—Ç—Å—è –≤ –∫–∞–≤—ã—á–∫–∏, `"table" != "TABLE"`

## –î–æ—Å—Ç—É–ø –∫ –æ–±—ä–µ–∫—Ç–∞–º

- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–º–µ–Ω–∏ —Å—Ö–µ–º–∞ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–µ—Ñ–∏–∫—Å–∞ 
```sql
SELECT * FROM stg.table;
```
- —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—É—Ç–∏ –ø–æ–∏—Å–∫–∞ `search_path` - —É–∫–∞–∑–∞–Ω–∏–µ –Ω—É–∂–Ω–æ–π —Å—Ö–µ–º—ã, –≤ –∫–æ—Ç–æ—Ä–æ–π –∏—Å–∫–∞—Ç—å –Ω—É–∂–Ω—ã–π –æ–±—ä–µ–∫—Ç

```sql
SELECT search_path; -- –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

SET search_path TO schema_name1 [, schema_name2, ....] -- –∑–∞–¥–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ
```
‚òùÔ∏è–∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—É—Ç–∏ –ø–æ–∏—Å–∫–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏


### ‚úçÔ∏è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 1

–°–æ–∑–¥–∞–≤–∞–ª–∏ —Ç–∞–±–ª–∏—Ü—ã –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ö–µ–º–∞—Ö, –º–µ–Ω—è–ª–∏ `search_path` –∏ —Å–º–æ—Ç—Ä–µ–ª–∏ –∫–∞–∫ —Å–µ–±—è –≤–µ–¥—É—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü.

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ Postgres —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å—Ö–µ–º—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä:
- pg_catalog
- information_schema
- pg_aoseg - —Å–ª—É–∂–µ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∞–±–ª–∏—Ü–∞—Ö append_optimized
- pg_toast - —Ö—Ä–∞–Ω–∏—Ç –æ–±—ä–µ–∫—Ç—ã, —Ä–∞–∑–º–µ—Ä –∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–µ–≤—ã—à–∞–µ—Ç —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é 32–ö–ë)
- pg_bitmapindex - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ bitmap-–∏–Ω–¥–µ–∫—Å–∞—Ö
- gp_toolkit - –æ–±—ä–µ–∫—Ç—ã, –Ω–µ–æ—å—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö —Å–∏—Å—Ç–µ–º—ã–Ω—Ö –º–µ—Ç—Ä–∏–∫

[üëâ –ö –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](https://github.com/urevoleg/course-gp/blob/main/chapter2/README.md#—Ñ–∏–∑–∏—á–µ—Å–∫–∞—è-–º–æ–¥–µ–ª—å-–¥–∞–Ω–Ω—ã—Ö-–∏-ddl)

## –¢–∞–±–ª–∏—Ü—ã: –≤–∏–¥—ã, –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏—è –∏ —Å–∂–∞—Ç–∏–µ

### –î–∏—Å—Ç—Ä–∏–±—É—Ü–∏—è

![data-distribution.png](..%2Fimg%2Fdata-distribution.png)

–ö–æ–Ω—Ü–µ–ø—Ü–∏—è –ú–†–† - —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏, –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏–≤–∞–Ω–∏—è –∏ —É—Å–∫–æ—Ä–µ–Ω–∏—è –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏.
–¢–∞–∫–æ–π –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–ª–∏ **—à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ** –∏–ª–∏ **–¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏—è** . –î–ª—è GreenPlum –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏—è

–í–ê–ñ–ù–û: —É GP –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–ø–∏–π –¥–∞–Ω–Ω—ã—Ö —à–∞—Ä–¥–∞ –Ω–∞ –æ–¥–Ω–æ–º —Å–µ–≥–º–µ–Ω—Ç–µ, –ø–æ—ç—Ç–æ–º—É –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∏–º–µ–µ—Ç –≤—Å–µ–≥–æ 2 –∑–Ω–∞—á–µ–Ω–∏—è:
- 1 - –±–µ–∑ –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- 2 - —Å –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º (–ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é –≤ Managed Service for GP)

–î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏:
1. –î–∏—Å—Ç—Ä–∏–±—É—Ü–∏—è –ø–æ –∫–ª—é—á—É üîë (DISTRIBUTED BY):
 - –ö–ª—é—á –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏ –º–æ–∂–µ—Ç —Å–æ—Å—Ç–æ—è—Ç –∏–∑ 1 –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª–µ–π
 - –∫–ª—é—á –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏ –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –≤—ã—Å–æ–∫—É—é –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å - —á–∏—Å–ª–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
 - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–∞ –≤—ã–±–∏—Ä–∞—Ç—å –ø–æ–ª—è —Å JOIN
 - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ –±–æ–ª–µ–µ 3-–ø–æ–ª–µ–π

–ü—Ä–∏–º–µ—Ä:
```sql
CREATE TABLE t1 (
    id int,
    field1 String,
    ....
)
DISTRIBUTED BY (id, field1)
```

2. –°—É—á–∞–π–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (DISTRIBUTED RANDOMLY):
 - –µ—Å–ª–∏ –Ω–µ —É–¥–∞—ë—Ç—Å—è –≤—ã–±—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–π –∫–ª—é—á —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, —Ö–æ—Ä–æ—à–∏–º –≤–∞—Ä–∏–∞–Ω—Ç–æ–º –±—É–¥–µ—Ç —Å–ª—É—á–∞–π–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ
–ø—Ä–∏–Ω—Ü–∏–ø—É Round-Robin

3. –†–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏—è (DISTRIBUTED RANDOMLY):
 - –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ–≥–º–µ–Ω—Ç–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ–ª–Ω–∞—è –∫–æ–ø–∏—è –¥–∞–Ω–Ω—ã—Ö (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ —Ä–∞–∑–º–µ—Ä —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –ö–†–ê–¢–ù–û). –¢–∞–∫–æ–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–ª–æ–≤–∞—Ä–µ–π –∏ –Ω–µ–±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü

–°–∫–æ—Ä–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ = —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ —Å–∞–º–æ–º –º–µ–¥–ª–µ–Ω–Ω–æ–º —Å–µ–≥–º–µ–Ω—Ç–µ -> –ø–æ—ç—Ç–æ–º—É **–í–´–ë–û–† –ö–õ–Æ–ß–ê –î–ò–°–¢–†–ò–ë–£–¶–ò–ò –∫—Ä–∞–π–Ω–µ –í–ê–ñ–ï–ù**

–ö–ª—é—á –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏ –º–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å, –¥–ª—è —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã:
```sql
ALTER TABLE stg.table SET DISTRIBUTED BY (new_key); -- –∑–∞–º–µ–Ω–∞ –∫–ª—é—á–∞
ALTER TABLE stg.table SET WITH (REORGANIZE=true); -- –ø–µ—Ä–µ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã, –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –¥–æ–≤–æ–ª—å–Ω–æ –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
```

------------------------
## –¢–∞–±–ª–∏—Ü—ã –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É —Å–ø–æ—Å–æ–±—É —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–∏—Å–∫–µ

### HEAP

![heap-table.png](..%2Fimg%2Fheap-table.png)

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –ø—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–Ω–∞—è –∏–∑ Postgres
- —Å–æ–∑–¥–∞–µ—Ç –Ω–∞–∏–º–µ–Ω—å—à–µ–µ –∫–æ–ª-–≤–æ —Ñ–∞–π–ª–æ–≤ –Ω–∞ –¥–∏—Å–∫–µ
- –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ–≥–º–µ–Ω—Ç–µ –∑–∞–ø–∏—Å–∏ —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤ —Ñ–∞–π–ª
- –∫–æ–ª-–≤–æ —Ñ–∞–π–ª–æ–≤ –º–æ–∂–µ—Ç —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å—Å—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ 1–ì–ë –∏–ª–∏ –ø—Ä–∏ —Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª–∏–Ω—ã (VARCHAR)
- –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (row-oriented)
- —Å–∂–∞—Ç–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ
- —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –ø—Ä–∏ `CREATE TABLE` –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø—Ü–∏–π

–ö–µ–π—Å—ã:
- —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –∫–µ–π—Å—ã (–º–Ω–æ–≥–æ DELETE\UPDATE\INSERT)
- –¥–ª—è –º–∞–ª—ã—Ö —Ç–∞–±–ª–∏—Ü –¥–æ 1–ì–ë

### APPEND-OPTIMIZED-—Ç–∞–±–ª–∏—Ü—ã

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –Ω—É–∂–Ω—ã –¥–ª—è —Å–∂–∞—Ç–∏—è –¥–∞–Ω–Ω—ã—Ö - **–ì–õ–ê–í–ù–ê–Ø –û–°–û–ë–ï–ù–ù–û–°–¢–¨**
- –∏–º–µ—é—Ç —Å–ª–æ–∂–Ω—É—é –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –∫–∞–∫ row-oriented, —Ç–∞–∫ –∏ column-oriented. –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã. –ü–æ –¥–µ—Ñ–æ–ª—Ç—É: **row-oriented**

–í—ã–±–æ—Ä —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –±–ª–æ–∫–µ WITH:

```sql
CREATE TABLE t1 (
    id int,
    field1 String,
    ....
)
DISTRIBUTED RANDOMLY
WITH (appendoptimized=TRUE, orientation=COLUMN);  
```

–î–µ—Ç–∞–ª–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–∞ —Ä–∏—Å:

![append-optimized-table.png](..%2Fimg%2Fappend-optimized-table.png)


–ö–µ–π—Å—ã:
- —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ –∏ –±–æ–ª—å—à–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ —Ç–∞–±–ª–∏—Ü - –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —Å–∂–∞—Ç–∏–µ –±—É–¥—É—Ç –ø—Ä–µ–≤—ã—â–∞—é—Ç –≤—ã–≥–æ–¥—É –æ—Ç —Å–∂–∞—Ç–∏—è
- –º–∞—Å—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–µ–π—Å—ã (–∫—Ä—É–ø–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ batch + –¥–æ—Å—Ç—É–ø –Ω–∞ —á—Ç–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–º–æ—â–∏ SELECT)

--------------------------------
## –°–∂–∞—Ç–∏–µ

![compression-meme.png](..%2Fimg%2Fcompression-meme.png)

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –∏ —Å—Ç–µ–ø–µ–Ω–µ–π —Å–∂–∞—Ç–∏—è (1-19)
- —Å–∂–∞—Ç–∏—è –∑–∞–¥–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω–æ –ø—Ä–∏ –ø–æ–º–æ—â–∏ `ALTER`
- –ø—Ä–∏ column-oriented —Ö—Ä–∞–Ω–µ–Ω–∏–∏: —Ä–∞–∑–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –∏ —Å—Ç–µ–ø–µ–Ω–∏ —Å–∂–∞—Ç–∏—è
- —Å–∂–∞—Ç–∏–µ —ç–∫–æ–Ω–æ–º–∏—Ç –¥–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∑–∞ —Å—á–µ—Ç CPU
- –Ω–µ–º–Ω–æ–≥–æ –∑–∞–º–µ–¥–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω–Ω—ã—Ö –∏–∑-–∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CPU –ø—Ä–∏ —Å–∂–∞—Ç–∏–∏
- —á—Ç–µ–Ω–∏–µ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Å–∂–∞—Ç–∏—è (–º–µ–Ω–µ–µ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç CPU)

–ê–ª–≥–æ—Ä–∏—Ç—ã —Å–∂–∞—Ç–∏—è: **zstd** (–Ω–æ–≤—ã–π/—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è), **zlib**(—Å–æ—Ö—Ä–∞–Ω–µ–Ω –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏), **rle_type**(—Ç–æ–ª—å–∫–æ
–¥–ª—è column-oriented –∏ –¥–ª—è —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã—Ö —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤/date/time)

**–õ—É—á—à–µ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ: zstd\zlib –ø—Ä–∏ —Å—Ç–µ–ø–µ–Ω —Å–∂–∞—Ç–∏—è 1-2, rle_type —Å–∂–∞—Ç–∏–µ 2**

–ü—Ä–∏–º–µ—Ä:
```sql
CREATE TABLE t1 (
    id int,
    field1 String,
    ....
)
WITH (appendoptimized=TRUE, orientation=COLUMN, 
    compresstype=zstd, compresslevel=2)
DISTRIBUTED by (id);  
```

–ß–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞—é—â–∏–µ—Å—è –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –ø–æ–∫–∞–∑–∞–Ω—ã –≤ —Ç–∞–±–ª–∏—Ü–µ:

![freq-cases-typetable-compress.png](..%2Fimg%2Ffreq-cases-typetable-compress.png)

------------------------------
## –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –∂–∏–≤—É—Ç –≤ —Ä–∞–º–∫–∞—Ö —Å–µ—Å—Å–∏–∏ (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ–º –æ—Ç –Ω–µ—ë)
- —Å–æ–∑–¥–∞–Ω–∏–µ = —É–∫–∞–∑–∞–Ω–∏–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ `CREATE TEMPORARY TABLE` (–ø–æ–¥–¥–µ—Ä–∂–∏–∞—é—Ç—Å—è –≤—Å–µ —à—Ç—É–∫–∏: –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏—è, —Ç–∏–ø—ã —Ç–∞–±–ª–∏—Ü, —Å–∂–∞—Ç–∏–µ)
- –∏–º—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –ø–∏—à–µ—Ç –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è —Å—Ö–µ–º—ã (–æ–Ω–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–π —Å—Ö–µ–º–µ), —Å—Ö–µ–º–∞ —Ç–æ–∂–µ —è–≤–ª—è–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∏ —É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å–µ—Å—Å–∏–∏
- –º–æ–∂–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ü–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–∏ –ø–æ–º–æ—â–∏ –±–ª–æ–∫–∞ `ON COMMIT`:
  - `ON COMMIT DELETE ROWS` - –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –≤ –∫–æ–Ω—Ü–µ –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  - `ON COMMIT DROP` - –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∞ –≤ –∫–æ–Ω—Ü–µ –±–ª–æ–∫–∞ —Ç–µ–∫—É—â–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

------------------------------
## –ù–µ–∂—É—Ä–Ω–∞–ª–∏—Ä—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã

![turbo-nonjournal-table.png](..%2Fimg%2Fturbo-nonjournal-table.png)

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –Ω–∏—á–µ–≥–æ –∫—Ä–æ–º–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ (–¥–∞–Ω–Ω—ã–µ –ø–∏—à—É—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ —Ç–∞–±–ª–∏—Ü—É, –º–∏–Ω—É—è WAL)
- —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏:
  - –Ω–µ—Ç WAL
  - –Ω–µ—Ç –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è
  - –ø—Ä–∏ —Å–±–æ–µ/—Ä–µ—Å—Ç–∞—Ä—Ç–µ —Ç–∞–±–ª–∏—Ü–∞ –±—É–¥–µ—Ç –ø—É—Å—Ç–æ–π, —Ö–æ—Ç—è —Å–∞–º–∞ –æ–Ω–∞ —Å–æ–∑–¥–∞—Å—Ç—Å—è
- —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ `CREATE UNLOGGED TABLE`
- –æ–ø—Ü–∏–∏ –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏/—Å–∂–∞—Ç–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã

–ö–µ–π—Å—ã:
- –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∏—Ç—Ä–∏–Ω—ã, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –Ω—É–∂–Ω—ã–µ —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –≤–ª–∏—Ç—å –∏—Ö –≤ —Ç–∞–±–ª–∏—Ü—É)

---------------------------
## –í–Ω–µ—à–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –Ω–µ —Ö—Ä–∞–Ω—è—Ç –¥–∞–Ω–Ω—ã–µ
- –æ–ø–∏—Å—ã–≤–∞—é—Ç —Ñ–æ—Ä–º–∞—Ç –∏ –ø—É—Ç—å –∫ –¥–∞–Ω–Ω—ã–º, –Ω–∞—Ö–æ–¥—è—â–∏–º—Å—è –≤–æ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–∞–π–ª—ã –∏–ª–∏ –¥—Ä—É–≥–∏–µ –°–£–ë–î)

–°–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ `EXTERNAL` —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–∏–ø–∞ —Ç–∞–±–ª–∏—Ü—ã:
- `READABLE`
- `WRITEABLE`

---------------------------

### ‚úçÔ∏è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 2: –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Å–∂–∞—Ç–∏—è

1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º zstd —Å —É—Ä–æ–≤–Ω–µ–º 2:

```sql
CREATE TABLE public.urev_t2_compress (
    id int,
    category int,
    value float
)
WITH (appendoptimized=TRUE,
    compresstype=zstd, 
    compresslevel=2);
```

2. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –±–µ–∑ —Å–∂–∞—Ç–∏—è
```sql
CREATE TABLE public.urev_t2_nocompress (
    id int,
    category int,
    value float
)
WITH (appendoptimized=TRUE);
```

3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–º–∏ –æ–±–µ —Ç–∞–±–ª–∏—Ü—ã (100000+ —Å—Ç—Ä–æ–∫)

–°–∫—Ä–∏–ø—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏ [generate_data.sql](sql%2Fgenerate_data.sql)

4. –ß–µ–∫–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã —Ç–∞–±–ª–∏—Ü –ø—Ä–∏ –ø–æ–º–æ—â–∏ –Ω–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ [compare_table_size.sql](sql%2Fcompare_table_size.sql) üòú

![chapter2-compare-table-size.png](..%2Fimg%2Fchapter2-compare-table-size.png)

![surprise.png](..%2Fimg%2Fsurprise.png)

–£–¥–∏–≤–ª–µ–Ω—ã, ..... –Ω–µ—Ç, —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∂–∞—Ç–∏–µ –¥–∞–Ω–Ω—ã–µü§ò

[üëâ –ö –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](https://github.com/urevoleg/course-gp/blob/main/chapter2/README.md#—Ñ–∏–∑–∏—á–µ—Å–∫–∞—è-–º–æ–¥–µ–ª—å-–¥–∞–Ω–Ω—ã—Ö-–∏-ddl)

--------------------------------
## –¢–∞–±–ª–∏—Ü—ã: –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ —á–∞—Å—Ç–∏ (–ø–∞—Ä—Ç–∏—Ü–∏–∏). –¶–µ–ª—å –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏—è - —Ñ–∏–∑–∏—á–µ—Å–∫–∏ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ —á–∞—Å—Ç–∏,
—á—Ç–æ–±—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é –≤—ã–±–æ—Ä–∫–∏.

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- —á—Ç–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–µ –≤—Å–µ–π —Ç–∞–±–ª–∏—Ü—ã, –∞ —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç–∏ —Ç–∞–±–ª–∏—Ü—ã - —á—Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –±—ã—Å—Ç—Ä–æ–¥–µ–π—Å—Ç–≤–∏–µ
- –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–∞—Å—Å–∏–≤–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø–∞—Ä—Ç–∏—Ü–∏–µ–π (–µ—ë –º–æ–∂–Ω–æ —á–∏—Å—Ç–∏—Ç—å –ø—Ä–∏ –ø–æ–º–æ—â–∏ `TRUNCATE`, 
—á—Ç–æ –±—ã—Å—Ç—Ä–µ–µ —á–µ–º `DELETE .... WHERE ...` –∏–∑ –Ω–µ–ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã)
- –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã: –ø–∞—Ä—Ç–∏—Ü–∏—è - —ç—Ç–æ —Ñ–∞–π–ª –Ω–∞ –¥–∏—Å–∫–µ, –ø—Ä–∏ –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–ª-–≤–æ —Ñ–∞–π–ª–æ–≤ –≤–æ–∑—Ä–∞—Å—Ç–∞–µ—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –±–æ–ª—å—à–∏–µ —Ç–∞–±–ª–∏—Ü—ã)
- **–∫–ª—é—á –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏—è** - –ø–æ–ª–µ, –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –≤ –∫–∞–∫—É—é –ø–∞—Ä—Ç–∏—Ü–∏—é –±—É–¥–µ—Ç –∑–∞–ø–∏—Å–∞–Ω–∞ —Å—Ç—Ä–æ–∫–∞.
- **–í–ê–ñ–ù–û:** —Å–¥–µ–ª–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –µ—ë —Å–æ–∑–¥–∞–Ω–∏–∏

–ü—Ä–∏–º–µ—Ä –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã:

![partition_schema.png](..%2Fimg%2Fpartition_schema.png)


–î–ª—è –∑–∞–¥–∞–Ω–∏—è –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `PARTITION BY`, —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤ —Å–µ–∫—Ü–∏–∏ `CREATE TABLE` –ø–æ—Å–ª–µ 
`DISTRIBUTED BY`: –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –º–µ—Ç–æ–¥ –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–ª—é—á–∞ –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–∞—Ä—Ç–∏—Ü–∏–∏.

–†–∞–∑–ª–∏—á–∞—é—Ç—Å—è –¥–≤–∞ –º–µ—Ç–æ–¥–∞:
1. `PARTITION BY RANGE(key)` - –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É

```sql
PARTITION BY RANGE ( *–∫–ª—é—á_–ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏—è* )
(
    PARTITION *–∏–º—è_–ø–∞—Ä—Ç–∏—Ü–∏–∏_1* START ( *–Ω–∞—á–∞–ª–æ_–¥–∏–∞–ø–∞–∑–æ–Ω–∞_1* ) END (*–∫–æ–Ω–µ—Ü_–¥–∏–∞–ø–∞–∑–æ–Ω–∞_1*),
    PARTITION *–∏–º—è_–ø–∞—Ä—Ç–∏—Ü–∏–∏_2* START ( *–Ω–∞—á–∞–ª–æ_–¥–∏–∞–ø–∞–∑–æ–Ω–∞_2* ) END (*–∫–æ–Ω–µ—Ü_–¥–∏–∞–ø–∞–∑–æ–Ω–∞_2*),
    ...
)
```

–ü–æ-—É–º–æ–ª—á–∞–Ω–∏—é:
- `START` –≤—Ö–æ–¥–∏—Ç –≤ –¥–∏–∞–ø–∞–∑–æ–Ω, `END` –Ω–µ –≤—Ö–æ–¥–∏—Ç, –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω–æ –æ–ø—Ü–∏—è–º–∏ `INCLUSIVE`\`EXCLUSIVE`

–ò–º—è –ø–∞—Ä—Ç—Ü–∏–∏ –º–æ–∂–µ—Ç –∑–∞–¥–∞–≤–∞—Ç—å—Å—è, –µ—Å–ª–∏ –æ–Ω–æ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, —Ç–æ GP —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω–æ–µ –∏–º—è.

–ü—Ä–∏–º–µ—Ä:
```sql
CREATE TABLE orders (
  id INT,
  ....
  order_creation_dttm TIMESTAMP WITH TIME ZONE
)
WITH (appendonly=TRUE, compresslevel=2, compresstype=zstd)
DISTRIBUTED BY (id)
PARTITION BY RANGE (order_creation_dttm)
(
PARTITION month202301 START ('2023-01-01 00:00:00')
                    END ('2023-02-01 00:00:00')
                    WITH (appendonly=TRUE, compresslevel=1, compresstype=zstd),
PARTITION month202302 START ('2023-02-01 00:00:00')
                    END ('2023-03-01 00:00:00'),
PARTITION month202303 START ('2023-03-01 00:00:00') INCLUSIVE
                    END ('2023-04-01 00:00:00') EXCLUSIVE
                    WITH (appendonly=TRUE, compresslevel=1, compresstype=zlib)
);
```

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –æ–ø—Ü–∏–∏ `WITH` –ø—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ –ø–∞—Ä—Ç–∏—Ü–∏–∏ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—É—é –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é –∏ —Å–∂–∞—Ç–∏–µ –¥–ª—è –∫–∞–∂–¥—ã–π –ø–∞—Ä—Ç—Ü–∏–∏,
–µ—Å–ª–∏ –æ–ø—Ü–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞, —Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã.

–ß—Ç–æ–±—ã –Ω–µ –æ–ø–∏—Å—ã–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ –∫–∞–∂–¥—É—é –ø–∞—Ä—Ç–∏—Ü–∏—é —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Å–ª–µ–¥—É—é—â–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `EVERY`):
```sql
....
PARTITION BY RANGE (value_start_ts)
    (START ('2010-01-01 00:00:00')
    END ('2030-01-01 00:00:00')
    EVERY (INTERVAL '1 month')); 
```

2. `PARTITION BY LIST(key)` - –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Å–ø–∏—Å–∫—É –∑–Ω–∞—á–µ–Ω–∏–π - **–∫–∞–∂–¥–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —è–≤–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ DDL**

–ú–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –¥–µ—Ñ–æ–ª—Ç: `DEFAULT PARTITION default_partition_name` - —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø–∞—Ç–∏—Ü–∏—è, –∫—É–¥–∞ –ø–æ–ø–∞–¥–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ø–∞–≤—à–∏–µ –Ω–∏ –≤ –æ–¥–Ω—É –∏–∑ –æ–ø–∏—Å–∞–Ω–Ω—ã—Ö


### ‚úçÔ∏è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 3: –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ

1Ô∏è‚É£ –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É —Å –ø–æ–ª—è–º–∏ id INT –∏ date_begin TIMESTAMP, 
–ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø–æ date_begin –ø–æ–Ω–µ–¥–µ–ª—å–Ω–æ —Å 1 —è–Ω–≤–∞—Ä—è 2023 –≥–æ–¥–∞ –ø–æ 31 –¥–µ–∫–∞–±—Ä—è 2023 –≥–æ–¥–∞.

```sql
CREATE TABLE public.urev_t2_parts (
    id int,
    date_begin TIMESTAMP
)
WITH (appendoptimized=TRUE,
    compresstype=zstd, 
    compresslevel=2)
PARTITION BY RANGE (date_begin)
(START ('2023-01-01 00:00:00')
END ('2024-01-01 00:00:00')
EVERY ( INTERVAL '1 week'));
```

**–í–ê–ñ–ù–û:** —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤ –∫—É—Ä—Å–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É —Å EVERY –Ω–µ—Ä–∞–±–æ—á–∏–π (—Ç–∞–∫–∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã —Å–∫–æ–±–∫–∏ –∏ —É–∫–∞–∑–∞–Ω–∏–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ INTERVAL)

2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ –∏ –ø–∞—Ä—Ç–∏—Ü–∏–∏ —Å–æ–∑–¥–∞–ª–∏—Å—å, –≤—ã–±—Ä–∞–≤ –Ω—É–∂–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –∫–∞—Ç–∞–ª–æ–≥–∞ `pg_partitions`.

```sql
select schemaname, 
       tablename, 
       partitiontablename, 
       partitionrangestart, 
       partitionrangeend
from pg_partitions
where tablename = 'urev_t2_parts';
```

![urev_t2_parts.png](..%2Fimg%2Furev_t2_parts.png)

–í—Å—ë –Ω–∞ –º–µ—Å—Ç–µ –∏ –ø–æ –Ω–µ–¥–µ–ª—å–Ω–æüëå

[üëâ –ö –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](https://github.com/urevoleg/course-gp/blob/main/chapter2/README.md#—Ñ–∏–∑–∏—á–µ—Å–∫–∞—è-–º–æ–¥–µ–ª—å-–¥–∞–Ω–Ω—ã—Ö-–∏-ddl)

----------------------

## –ó–∞–ø—Ä–æ—Å—ã –∏ DML-–æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏

- –ø–æ—Å–ª–µ –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –≤–µ—Ä—Ö–Ω–µ—É—Ä–æ–≤–Ω–µ–≤–æ–π, –æ–Ω–∞ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã—Ö, –≤ –Ω–µ–π —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ –∫–æ–ª–æ–Ω–∫–∞—Ö –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö —Ö—Ä–∞–Ω–µ–Ω–∏—è
- –¥–∞–Ω–Ω—ã–µ –ª–µ–∂–∞—Ç –ø–∞—Ä—Ç–∏—Ü–∏—è—Ö
- –æ–ø–µ—Ä–∞—Ü–∏–∏ DML (INSERT/DELETE/UPDATE/SELECT) –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è –∫–∞–∫ —Å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π, —Ç–∞–∫ –∏ —Å –¥–æ—á–µ—Ä–Ω–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏. –í —Å–ª—É—á–∞–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π
GP —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫–∞–∫–∏–µ –ø–∞—Ä—Ç—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É

### ‚úçÔ∏è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 4: –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ —Å –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏

–î–ª—è –º–∞–Ω–∏–ø—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏ (DDL: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, –æ—á–∏—Å—Ç–∫–∞) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è `ALTER TABLE` –Ω–∞–¥ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ–π

1. **–ü—Ä–∞–∫—Ç–∏–∫–∞ –Ω–∞ —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–π —Ç–∞–±–ª–∏—Ü–µ** `public.urev_partitioned_table`:

```sql
CREATE TABLE public.urev_partitioned_table
(
    id INT,
    value_dttm TIMESTAMP
)
DISTRIBUTED BY (id)
PARTITION BY RANGE (value_dttm)
(
    PARTITION year2023 START ('2023-01-01 00:00:00')
                     END ('2024-01-01 00:00:00'),
    PARTITION year2024 START ('2024-01-01 00:00:00')
                     END ('2025-01-01 00:00:00')
);

insert into public.urev_partitioned_table(value_dttm, id)
SELECT generate_series('2023-01-01'::date, '2024-12-31'::date, '1 month') AS value_dttm, 
generate_series(1, 24) as id;
```

–ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ –µ—Å—Ç—å:

![partitions_dml_ddl_practice.png](..%2Fimg%2Fpartitions_dml_ddl_practice.png)

2. **–ú–∞–Ω–∏–ø—É–ª–∏—Ä—É–µ–º –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏**

–û–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –ø–∞—Ä—Ç–∏—Ü–∏—è–º –º–æ–∂–Ω–æ 2 —Å–ø–æ—Å–æ–±–∞–º–∏:
- –ø–æ –∏–º–µ–Ω–∏ (–≤ –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ `year2023` –∏–ª–∏ `year2023`)
- –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é —Å –∏–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ `FOR`

–î–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ø–∏—Å–∞–Ω SQL –∫–æ—Ç–æ—Ä—ã–π –≤—ã–≤–æ–¥–∏—Ç –∏–Ω—Ñ–æ –ø—Ä–æ –Ω–∞–ª–∏—á–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏ –∏ –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –Ω–µ–π:
[check_partition_and_count_data.sql](sql%2Fcheck_partition_and_count_data.sql)

–ü—Ä–∏–º–µ—Ä—ã –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏:

![dml_partition.png](..%2Fimg%2Fdml_partition.png)

3. **EXCHANGE PARTITON**
–ï—â–µ –æ–¥–Ω–∞ **–∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è:** `EXCHANGE PARTITON` - –∑–∞–º–µ–Ω–∞ –ø–∞—Ä—Ç–∏—Ü–∏–∏ –Ω–µ–ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ–π - –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Ç–∞–±–ª–∏—Ü–∞ —Å—Ç–∞–Ω–µ—Ç –ø–∞—Ä—Ç–∏—Ü–∏–µ–π –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã, 
–∞ –ø–∞—Ä—Ç–∏—Ü–∏—è —Å—Ç–∞–Ω–µ—Ç –æ–±—ã—á–Ω–æ–π —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ–π:
- –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π —Å –¥–∞–Ω–Ω—ã–º–∏
- –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∏—Å—Ö–æ–¥–Ω—É—é –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É (—Å–Ω–∞—á–∞–ª–∞ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É, –ø–æ—Å–ª–µ –º–µ–Ω—è—é—Ç—Å—è —Å –ø–∞—Ä—Ç–∏—Ü–∏–µ–π)
- –∞—Ç—Ä–∏–±—É—Ç—ã –ø–æ–¥–º–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã, –∫—Ä–æ–º–µ –Ω–∞–∑–≤–∞–Ω–∏—è, —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –ø–æ–¥–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å—Ç–∞–Ω–µ—Ç –ø–∞—Ä—Ç–∏—Ü–∏–µ–π. 
–í–µ—Ä–Ω–æ –∏ –æ–±—Ä–∞—Ç–Ω–æ–µ: –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ EXCHANGE –ø–æ–¥–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –±—É–¥–µ—Ç –∏–º–µ—Ç—å –æ–ø—Ü–∏–∏ –∏ –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏, —Å –∫–æ—Ç–æ—Ä–æ–π –µ—ë –æ–±–º–µ–Ω—è–ª–∏.


–°–º–æ—Ç—Ä–∏–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –¥–∞–Ω–Ω—ã–µ –≤ –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ:

![data_in_before_exchange.png](..%2Fimg%2Fdata_in_before_exchange.png)

–°–æ–∑–¥–∞–µ–º –Ω–µ–ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É —Å –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –ø–æ–ª–µ–π:

```sql
CREATE TABLE public.urev_nonpart_for_exchange
(
    id INT,
    value_dttm TIMESTAMP
)
DISTRIBUTED BY (id);

INSERT INTO public.urev_nonpart_for_exchange VALUES (10, '2024-01-07 11:17:00');
INSERT INTO public.urev_nonpart_for_exchange VALUES (15, '2024-03-08 11:17:00');
INSERT INTO public.urev_nonpart_for_exchange VALUES (15, '2024-09-11 21:58:00');
```

![nonparts_for_exchange_table.png](..%2Fimg%2Fnonparts_for_exchange_table.png)

–í—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–¥–º–µ–Ω—É –ø–∞—Ä—Ç–∏—Ü–∏–∏:

```sql
ALTER TABLE urev_partitioned_table EXCHANGE PARTITION year2024 WITH TABLE public.urev_nonpart_for_exchange;
```

–ü—Ä–æ–≤–µ—Ä—è–µ–º:

![exchange_partition_complete.png](..%2Fimg%2Fexchange_partition_complete.png)

–¢–∞–±–ª–∏—Ü–∞ –∏ –ø–∞—Ä—Ç–∏—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–¥–º–µ–Ω–∏–ª–∏—Å—å - –±–∏–Ω–≥–æ üëç

[üëâ –ö –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](https://github.com/urevoleg/course-gp/blob/main/chapter2/README.md#—Ñ–∏–∑–∏—á–µ—Å–∫–∞—è-–º–æ–¥–µ–ª—å-–¥–∞–Ω–Ω—ã—Ö-–∏-ddl)

–í –∫–∞—á–µ—Å—Ç–≤–µ –ø–æ–¥–º–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–µ —Ç–∞–±–ª–∏—Ü - —Ç–∞–∫ –º–æ–∂–Ω–æ –≤—ã–Ω–æ—Å–∏—Ç—å —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö (–∫—Ä–∞–π–Ω–µ —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö)
–≤–æ –≤–Ω–µ—à–Ω—é—é —Å–∏—Å—Ç–µ–º—É –∏ –Ω–µ –∑–∞–Ω–∏–º–∞—Ç—å –º–µ—Å—Ç–æ –≤ GP. 

PS: –≤ –∫—É—Ä—Å–µ –∏–¥–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Ç–∞–∫ —Å–¥–µ–ª–∞—Ç—å, –Ω–æ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å–æ–∑–¥–∞—Ç—å –≤–Ω–µ—à–Ω—é—é —Ç–∞–±–ª–∏—Ü—É –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–∞:

![error_create_external_table.png](..%2Fimg%2Ferror_create_external_table.png)

-----------------------------
### –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ

GP –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ –¥–∞—Ç–µ –∏ —Ä–µ–≥–∏–æ–Ω—É –∏–ª–∏ –≥—Ä—É–ø–ø–µ):
- –¥–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ª–∏—Å—Ç–æ–≤—ã–∑ —Ç–∞–±–ª–∏—Ü–∞—Ö - –≤—Å–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –µ—â–µ –±–æ–ª—å—à–µ–º—É —Ä–∞–∑—Ä–∞—Å—Ç–∞–Ω–∏—é –∫–æ–ª-–≤–∞ —Ç–∞–±–ª–∏—Ü –∏ —Ñ–∞–π–ª–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ

–í–æ–ø—Ä–æ—Å—ã –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º:
- –ö–∞–∫–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π –µ—Å–ª–∏ –≤ –ø–æ–¥–º–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ, –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –ø–æ–¥ —Ç–∞–±–ª–∏—Ü—ã –∏ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–µ (–±—É–¥–µ—Ç –æ—à–∏–±–∫–∞)
- –ß—É—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è == external_table

----------------------------------

## –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

–ë—É–¥—É—Ç –∑–∞–∫–æ—Å–ø–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–µ–æ—á–µ–≤–∏–¥–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã: —Ç–∫ —Å–æ—Å—Ç–∞–≤ –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å PostgreSQL.

- –î–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã –Ω–µ—è–≤–Ω–æ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å–æ—Å—Ç–∞–≤–Ω–æ–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö, —Å–æ—Å—Ç–æ—è—â–∏–π –∏–∑ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Ç–∞–±–ª–∏—Ü—ã.
- –≤—Å–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö, –≤–∫–ª—é—á–∞—è —Å–æ—Å—Ç–∞–≤–Ω—ã–µ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ **pg_type**


### –õ–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç–∏–ø—ã

- TRUE (yes, on, 1)
- FALSE (no, off, 0)
- NULL

### –¶–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω—ã–µ —Å –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–æ–º

- Serial (4 –±–∞–π—Ç–∞)
- BigSerial (8 –±–∞–π—Ç)

–ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç –∑–∞–º–µ–¥–ª—è–µ—Ç (—Ç–∫ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Å–≤—è–∑–∞–Ω–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å) –º–∞—Å—Å–∏–≤–Ω—ã–µ –≤—Å—Ç–∞–≤–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—É (–Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –Ω–∞ –º–∞—Å—Ç–µ—Ä–µ)
–í —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞—è—Ö —Å–ª–µ–¥—É–µ—Ç —É–≤–µ–ª–∏—á–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ `CACHE`

–í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ –Ω–µ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–Ω–æ–µ –ø–æ–ª–µ, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –æ–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–ª—é—á–∞ –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏,
–≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –ª—É—á—à–µ –≤—ã–±—Ä–∞—Ç—å —Å–ª—É—á–∞–π–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `DISTRIBUTED RANDOMLY`

### –°—Ç—Ä–æ–∫–æ–≤—ã–µ —Ç–∏–ø—ã

- Char(n) - —Å—Ç—Ä–æ–∫–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–ª–∏–Ω—ã
- Varchar(n) - —Å—Ç—Ä–æ–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª–∏–Ω—ã —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º n —Å–∏–º–≤–æ–ª–æ–≤
- Varchar/Text - —Å—Ç—Ä–æ–∫–∞ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –¥–ª–∏–Ω—ã (–∫—Ä–æ–º–µ –æ–±—â–µ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è GP/Postgres –Ω–∞ —Ä–∞–∑–º–µ—Ä –≤ 1–ì–ë)

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- `''' != Null`
- –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è escape –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–µ—Ñ–∏–∫—Å E –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã–≤–∞—é—â–µ–π –∫–∞–≤—ã—á–∫–æ–π
- –û–±—ã—á–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –Ω–µ –ø–æ–∑–≤–æ–ª—è—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–µ–ø–µ—á–∞—Ç–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∏ –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–º –Ω–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (—ç—Ç–æ —Ä–µ—à–∞–µ—Ç—Å—è —Ç–∏–ø–æ–º **bytea**)

### Date and Timestamp (Time, Interval)

![backtothefuture.jpg](..%2Fimg%2Fbacktothefuture.jpg)

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- **Date** –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É —Ö—Ä–∞–Ω–µ–Ω–∏—é –∞–Ω–∞–ª–æ–≥–∏—á–µ–Ω int, –µ–¥–∏–Ω–∏—Ü–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–¥–Ω–æ–º—É –¥–Ω—é.
- –° date –∏ int –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
  
![date_math_operations.png](..%2Fimg%2Fdate_math_operations.png)

- **interval** –ø—Ä–æ–º–µ–∂—É—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ —Å–µ–∫—É–Ω–¥.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å timestamp –∏ time ‚Äî –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å  
–∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–µ–∂–¥—É **time**, **timestamp** –∏ **interval**, –∫–∞–∫ —Å **date** –∏ **int**.
- –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –∑–∞–¥–∞–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–∏–µ–º –º–∏–Ω—É—Å `INTERVAL '-1day';`

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –≤ –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏ –∏ –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏–∏

- –¶–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω—ã–π —Ç–∏–ø –¥–∞—ë—Ç –∞–±—Å–æ–ª—é—Ç–Ω—É—é —Ç–æ—á–Ω–æ—Å—Ç—å –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Ç–∏–ø–æ–≤ —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π –∏ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Å—Ç—Ä–æ–∫ ‚Äî –∞ –∑–Ω–∞—á–∏—Ç, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±—ã—Å—Ç—Ä–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ö–µ—à–∞.
- –ª—É—á—à–∏–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏ - —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω—ã–π
- –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–∞ –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏ –¥–æ–ø—É—Å–∫–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥—Ä—É–≥–∏—Ö **–ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã—Ö —Ç–∏–ø–æ–≤**
- –ö–æ–ª–æ–Ω–∫–∏ —Å –≥–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ —Ç–∏–ø–∞–º–∏ –Ω–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∏—Ö –∫–ª—é—á–∞.
- –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –∫–ª—é—á–∞ –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—Ç–∞–ª–∫–∏–≤–∞–π—Ç–µ—Å—å –æ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞–∑–±–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ.
- –¥–ª—è –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥—è—Ç date/timestamp, –ø–æ —Å–ø–∏—Å–∫—É –ø–æ–¥—Ö–æ–¥–∏—Ç –ª—é–±–æ–π —Ç–∏–ø, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ (varchar/int)

### –°–æ—Å—Ç–∞–≤–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

**–ú–∞—Å—Å–∏–≤—ã**

- –Ω–∞–±–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã
- —Ç–∏–ø –º–∞—Å—Å–∏–≤–∞ –æ–±–æ–∑–Ω–∞—á–∞–µ—Ç—Å—è –∫–∞–∫ —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã—Ö —Å–∫–æ–±–æ–∫ `INTEGER []`, –º–Ω–æ–≥–æ–º–µ—Ä–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã `INTEGER [][]` (—Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)
- –º–∞—Å—Å–∏–≤ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å:
  - –ª–∏—Ç–µ—Ä–æ–π `ARRAY [1, 2, 3]`
  - —Å—Ç—Ä–æ–∫–æ–π `'{1, 3, 4}'::INTEGER[]`
- –¥–æ—Å—Ç—É–ø –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ—Å–∫–æ–±–æ—á–Ω–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–µ–π. ps: –ø—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã—Ö —Å–∫–æ–±–æ–∫, —Å—Ä–∞–∑—É –≤—Å–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –æ–Ωüëá

![spanch_bob.png](..%2Fimg%2Fspanch_bob.png)

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–∞—Å—Å–∏–≤–∞–º–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- **array_agg** - —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –º–∞—Å—Å–∏–≤
- **string_to_array** - —Ä–∞–∑–¥–µ–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –Ω–∞ –º–∞—Å—Å–∏–≤
- **unnest** - —Ä–∞—Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç –º–∞—Å—Å–∏–≤ –≤ —Å—Ç—Ä–æ–∫–∏

**–ö–æ—Ä—Ç–µ–∂**

- –î–æ—Å—Ç—É–ø –∫ –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø–æ–ª—è–º –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ—Ä—Ç–µ–∂–∞ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ —Ç–æ—á–∫—É, –Ω–∞–ø—Ä–∏–º–µ—Ä **(rowattr).field**
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∏–ø–∞ –∫–æ—Ä—Ç–µ–∂ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö –¥–ª—è –ø—Ä–æ—Ö–æ–¥–∞ –ø–æ –∑–∞–ø–∏—Å—è–º –≤ –∫—É—Ä—Å–æ—Ä–µ –∏–ª–∏ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–µ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ –≤–∏–¥–µ —Ç–∞–±–ª–∏—Ü—ã. 

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ç–∏–ø—ã

- –ø–æ–∑–≤–æ–ª—è—é—Ç –æ–±—Å—Ç—Ä–∞–≥–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –∏ —É–ø—Ä–æ—Å—Ç–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å –Ω–∏–º–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–∑–¥–∞–Ω–∏–µ –≥–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π —Ç–æ—á–∫–∏:

```sql

CREATE TYPE POINT AS ( x DOUBLE PRECISION, y DOUBLE PRECISION );
```

### JSON –∏ JSONB

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —Ä–∞–∑–ª–∏—á–∏—è –¥–≤—É—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –ø–æ–∫–∞–∑–∞–Ω—ã –Ω–∏–∂–µ:

![json_jsonb_compare.png](..%2Fimg%2Fjson_jsonb_compare.png)

–ù—é–∞–Ω—Å—ã:
- –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è, –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ø–µ—Ä–µ–¥–∞—á–∏ (—Ç–æ –µ—Å—Ç—å –±–µ–∑ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π) –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JSON - –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç –º–µ–Ω—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ –∏ –∑–∞–Ω–∏–º–∞–µ—Ç –º–µ–Ω—å—à–µ –º–µ—Å—Ç–∞
- –¥–ª—è –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π –≤—ã–±–∏—Ä–∞–µ–º JSONB - —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏ –¥–æ—Å—Ç—É–ø –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º –±—É–¥–µ—Ç –±—ã—Å—Ç—Ä—ã–º
- –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–∞–∫:

```sql
SELECT data->>'field' as name FROM table; 
```

### –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã

- UUID - —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä, –Ω–µ–∑–∞–≤–∏—Å—è—â–∏–π –æ—Ç –ë–î, `550e8400-e29b-41d4-a716-446655440000`
- CIDR - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ IP –∞–¥—Ä–µ—Å–æ–≤
- INET - —Ö—Ä–∞–Ω–µ–Ω–∏–µ IP 
- ENUM - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º
- OID, REGCLASS - —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–∏–ø—ã, —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞ GP

-------------------------------

## –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å:
- —è–≤–Ω–æ–µ
- –Ω–µ—è–≤–Ω–æ–µ

–ù–æ –∫–∞–∫ –º—ã –∑–Ω–∞–µ–º (–ø2):

![pyhon_zen.png](..%2Fimg%2Fpyhon_zen.png)

**–Ø–≤–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ:**
- –ø—Ä–∏ –ø–æ–º–æ—â–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ `CAST(var as type)`
- –ø—Ä–∏ –ø–æ–º–æ—â–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ `var::type` - —Å–æ–∫—Ä–∞—â–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å —Ç–æ–ª—å–∫–æ –≤ GP/Postgres

**–ù–µ—è–≤–Ω–æ–µ** –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∫–æ–≥–¥–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –¥—Ä—É–≥–æ–π –±–µ–∑ —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è:
- –ø—Ä–∏—Å–≤–æ–µ–Ω–∏—è (–æ–¥–∏–Ω —Ç–∏–ø –¥—Ä—É–≥–æ–º—É, –Ω–∞–ø—Ä–∏–º–µ—Ä date <-> timestamp)
- –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤
- –Ω–µ—è–≤–Ω—ã–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ

–§—É–Ω–∫—Ü–∏–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è:
- `TO_CHAR`
- `TO_NUMBER`
- `TO_DATE`

–ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –Ω–µ—è–≤–Ω—ã—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è—Ö:
- –ø–æ—Ç–µ—Ä—è —Ç–æ—á–Ω–æ—Å—Ç–∏
- –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö
- –Ω–µ–æ—á–µ–≤–∏–¥–Ω–æ—Å—Ç—å (–Ω–µ—è–≤–Ω—ã–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –Ω–µ –≤–∏–¥–Ω—ã –≤ –∫–æ–¥–µ, —Å–ª–æ–∂–Ω–µ–µ —á–∏—Ç–∞—Ç—å, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å –∫–æ–¥)

## –ü—Ä–æ—á–∏–µ –æ–±—ä–µ–∫—Ç—ã –ë–î: –∏–Ω–¥–µ–∫—Å—ã, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ò–Ω–¥–µ–∫—Å—ã

**–ò–Ω–¥–µ–∫—Å** - —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±—ã—Å—Ç—Ä–µ–µ. –≠—Ç–æ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö, —Ö—Ä–∞–Ω—è—â–∞—è—Å—è 
—Ä—è–¥–æ–º —Å —Ç–∞–±–ª–∏—Ü–µ–π, —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —Å—Ç–æ–ª–±—Ü–æ–≤:
- –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- —Å—Å—ã–ª–∫–∞ –Ω–∞ –¥–∞–Ω–Ω—ã–µ (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –±–ª–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ)

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–Ω–¥–µ–∫—Å–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç—Ä–æ–µ–Ω—ã —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º –æ–±—Ä–∞–∑–æ–º:
- [B-tree](https://ru.wikipedia.org/wiki/B-–¥–µ—Ä–µ–≤–æ)
- ....

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä
- –≤ GP –∏–Ω–¥–µ–∫—Å –≤–∏–¥–µ–Ω –∫–∞–∫ –æ–¥–∏–Ω –æ–±—ä–µ–∫ (—Ö–æ—Ç—è –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç–∞—Ö - –æ—Ç–¥–µ–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –Ω–∏—á–µ–º –∫—Ä–æ–º–µ –æ–±—â–µ–≥–æ –∏–º–µ–Ω–∏ –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ),
–ø–æ—ç—Ç–æ–º—É –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã **Primary Key\ Unique** —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–±–ª—é–¥–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∞–≤–∏–ª–∞
- –ò–Ω–¥–µ–∫—Å—ã Primary Key –∏ Unique –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –Ω–∞ APPEND-OPTIMIZED-—Ç–∞–±–ª–∏—Ü–∞—Ö.
- –Ω–∞–ª–∏—á–∏–µ –∏–Ω–¥–µ–∫—Å–∞ - –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è OLTP
- –∏–Ω–¥–µ–∫—Å - —ç—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (–∏–Ω–¥–µ–∫—Å –Ω–µ —Å–∂–∏–º–∞–µ—Ç—Å—è), –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ —Ç—ã—Å—è—á-–º–ª–Ω —Å—Ç—Ä–æ–∫ –∏–Ω–æ–≥–¥–∞ —É–¥–æ–±–Ω–µ–µ
—É–¥–∞–ª–∏—Ç—å –∏–Ω–¥–µ–∫—Å, –∞ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞—Ç—å –µ–≥–æ –∑–∞–Ω–æ–≤–æ)

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤ –∏–Ω–¥–µ–∫—Å–æ–≤:
- B-tree
- Bitmap
- GIST
- SP-GIST
- GIN

### B-tree

![b-tree.png](..%2Fimg%2Fb-tree.png)

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ –¥–µ—Ñ–æ–ª—Ç—É –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —á–∞—â–µ –≤—Å–µ–≥–æ
- –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è –∫–æ–ª–æ–Ω–∫–∏, —Ç–∏–ø—ã –∫–æ—Ç–æ—Ä—ã—Ö –º–æ–∂–Ω–æ —É–ø–æ—Ä—è–¥–æ—á–∏—Ç—å (–¥–∞—Ç—ã, —á–∏—Å–ª–∞, —Å—Ç—Ä–æ–∫–∏)
- –∫–æ—Ä–Ω–∏ –∏ –≤–µ—Ç–∫–∏ —Ö—Ä–∞–Ω—è—Ç —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º–æ–≥–æ –ø–æ–ª—è
- –ª–∏—Å—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –±–ª–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
- –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª—è—Ö

–°–∏–Ω—Ç–∞–∫—Å–∏—Å:

```sql
CREATE INDEX btree_index_1 ON table1 USING BTREE(column_name);

SELECT * FROM table1 WHERE columns_name >= 100 and < 150; -- –≤–µ—Ä–æ—è—Ç–Ω–µ–µ –≤—Å–µ–≥–æ –≤ —Ç–∞–∫–æ–º –∑–∞–ø—Ä–æ—Å–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∏–Ω–¥–µ–∫—Å
```

### Bitmap index

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç–∞–±–ª–∏—Ü —Å –Ω–µ–±–æ–ª—å—à–∏–º –∫–æ–ª-–≤–æ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–¥–æ 100000) –∏ –±–æ–ª—å—à–∏–º –∫–æ–ª-–≤–æ–º —Å—Ç—Ä–æ–∫
- —Å–æ–∑–¥–∞—ë—Ç—Å—è –±–∏—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞, –æ—Ç—Ä–∞–∂–∞—é—â–∞—è –Ω–∞–ª–∏—á–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º–æ–≥–æ –ø–æ–ª—è –≤ —Å—Ç—Ä–æ–∫–µ —Ç–∞–±–ª–∏—Ü—ã
- —Ö–æ—Ä–æ—à–æ —Å–∂–∏–º–∞–µ—Ç—Å—è –∏ –∑–∞–Ω–∏–º–∞–µ—Ç –º–∞–ª–æ –º–µ—Å—Ç–æ
- –æ—Å–æ–±–µ–Ω–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö –≥—Ä—É–ø–ø –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø–æ–ª—è–º

### GiST, SP-GiST –∏ GIN

- **Generalized Search Tree** (–û–±–æ–±—â—ë–Ω–Ω–æ–µ –¥–µ—Ä–µ–≤–æ –ø–æ–∏—Å–∫–∞)
- –ò–Ω–¥–µ–∫—Å—ã GiST –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–º–µ–Ω—å—à–∞—é—Ç –æ–±—ä—ë–º –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞.
- –ó–Ω–∞—á–µ–Ω–∏—è –≤ –∏–Ω–¥–µ–∫—Å–µ GiST –º–æ–≥—É—Ç —Å—Ç—Ä–æ–≥–æ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è–º –≤ —Ç–∞–±–ª–∏—Ü–µ, –ø–æ—Å–∫–æ–ª—å–∫—É —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ö–µ—à –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –¥–ª–∏–Ω—ã. (—Ö–µ—à —Ñ–∏—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–ª–∏–Ω—ã, –∞ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º—ã–µ –ø–æ–ª—è –Ω–µ—Ç)
- **SP-GiST: Space Partitioned** (–†–∞–∑–¥–µ–ª—è–µ–º–æ–µ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –æ–±–æ–±—â—ë–Ω–Ω–æ–µ –¥–µ—Ä–µ–≤–æ –ø–æ–∏—Å–∫–∞) –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –º–æ–∂–Ω–æ —Ä–∞–∑–±–∏—Ç—å –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –≥—Ä—É–ø–ø—ã –±–µ–∑ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π.
–ù–∞–ø—Ä–∏–º–µ—Ä, –≥–µ–æ—Ç–æ—á–∫–∏ –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç–∞—Ö –∏–ª–∏ —Å—Ç—Ä–∞–Ω–∞—Ö
- **GIN: Generalized Inverted Search Tree** (–û–±–æ–±—â—ë–Ω–Ω–æ–µ –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –¥–µ—Ä–µ–≤–æ –ø–æ–∏—Å–∫–∞) –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –ø–æ–ª—è–º —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö Greenplum Database Full Text Search –∏–ª–∏ –ø–æ–ª—è–º —Ç–∏–ø–∞ jsonb.
–ü–æ—Ö–æ–∂ –Ω–∞ Bitmap Index
- –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –Ω–µ–ª—å–∑—è –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω–¥–µ–∫—Å B-tree, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≥–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
-  GiST, SP-GiST, GIN –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –≥–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö, —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ç–∏–ø—ã –∏ —Ç–∏–ø—ã, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –æ—Ç–Ω–æ—à–µ–Ω–∏–π, –ø–æ–∑–≤–æ–ª—è—è —É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω—É–∂–Ω–æ–≥–æ —Ç–∏–ø–∞.

-----------------------------------------

![practice-1.png](..%2Fimg%2Fpractice-1.png)

#### ‚úçÔ∏è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 5: –∏–Ω–¥–µ–∫—Å—ã

1-2-3. –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É —Å –ø–æ–ª–µ–º id –∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏.

–ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø—Ä–∞–∫—Ç–∏–∫–∏ —Ç–∞–±–ª–∏—Ü—É: `urev_t2_nocompress`. –°—Ç—Ä–æ–∫ 200001 (+100001), —Ä–∞–∑–º–µ—Ä:

![nocompress_table_size_before_index.png](..%2Fimg%2Fnocompress_table_size_before_index.png)

4. –°–æ–∑–¥–∞–π—Ç–µ –∏–Ω–¥–µ–∫—Å –ø–æ –ø–æ–ª—é id —Ç–∏–ø–∞ b-tree.

```sql
CREATE INDEX urev_t2_nocompress_id_idx ON public.urev_t2_nocompress USING BTREE(id);
```

5. –°—Ä–∞–≤–Ω–∏—Ç–µ –ø–æ–ª–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü –¥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞ –∏ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞

![nocompress_table_size_after_index.png](..%2Fimg%2Fnocompress_table_size_after_index.png)

–†–∞–∑–Ω–∏—Ü–∞ –ø–æ—á—Ç–∏ 2 —Ä–∞–∑–∞üò≥

6. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SELECT –∏–∑ —Ç–∞–±–ª–∏—Ü—ã pg_indexes, –Ω–∞–π–¥–∏—Ç–µ —Å–≤–æ–π –∏–Ω–¥–µ–∫—Å

![find_index_in_pg_indexes.png](..%2Fimg%2Ffind_index_in_pg_indexes.png)

[üëâ –ö –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](https://github.com/urevoleg/course-gp/blob/main/chapter2/README.md#—Ñ–∏–∑–∏—á–µ—Å–∫–∞—è-–º–æ–¥–µ–ª—å-–¥–∞–Ω–Ω—ã—Ö-–∏-ddl)


## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏** - –ø—Ä–∞–≤–∏–ª–∞, –∫–æ—Ç–æ—Ä—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º:
- –Ω–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å NULL
- –≤—ã–ø–æ–ª–Ω—è—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –¥–∏–∞–ø–∞–∑–æ–Ω –∑–Ω–∞—á–µ–Ω–∏–π
- –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ –≤—Å–µ–º –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ç–∞–±–ª–∏—Ü–∞–º, –Ω–æ **_–µ—Å–ª–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω–µ—à–Ω—è—è —Ç–∞–±–ª–∏—Ü–∞, —Ç–æ –∫ —Ç–∞–∫–∏–º —Ç–∞–±–ª–∏—Ü–∞–º 
–Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è_**

–í–∞—Ä–∏–∞–Ω—Ç—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π:
1. `CHECK`

![constrain_check.png](..%2Fimg%2Fconstrain_check.png)

- –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Ç–∞–±–ª–∏—Ü—É

```sql
CREATE TABLE t (
    id SERIAL,
    value  int CHECK (value >= 0)
)
```

2. `NOT NULL` - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
3. `UNIQUE` - —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
4. `PRIMARY KEY` - —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∏ –Ω–µ–ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

**–í–ê–ñ–ù–û:**
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è **UNIQUE** –∏ **PRIMARY KEY** –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤ HEAP-—Ç–∞–±–ª–∏—Ü–∞—Ö, 
—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –ø–æ –∫–ª—é—á—É –∏–ª–∏ **distributed replicated**. –í—Å–µ –∫–æ–ª–æ–Ω–∫–∏, –≤—Ö–æ–¥—è—â–∏–µ –≤ –∫–ª—é—á —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, –¥–æ–ª–∂–Ω—ã —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ UNIQUE –∏–ª–∏ PRIMARY KEY, 
—Ç–∞–∫ –∫–∞–∫ –∫–ª—é—á –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–º–∫–∞—Ö —Ç–µ–∫—É—â–µ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞, –∞ –∫–ª—é—á –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ –∑–∞–ø–∏—Å–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∫–ª—é—á–∞ –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏ –ø–æ–ø–∞–¥—É—Ç –Ω–∞ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Å–µ–≥–º–µ–Ω—Ç.
–ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞, –ø–æ–ª–µ –∫–ª—é—á–∞ –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∞–∫–∂–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ **UNIQUE** –∏–ª–∏ **PRIMARY KEY**


5. **FOREIGN KEY** –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: —Å–æ–∑–¥–∞–Ω–∏–µ FOREIGN KEY –≤–æ–∑–º–æ–∂–Ω–æ, –Ω–æ –°–£–ë–î –Ω–µ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –µ–≥–æ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Ç–∞–±–ª–∏—Ü—É.

–í—Å–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ **pg_constraint**.

-------------------------
### ‚úçÔ∏è  –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 6: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏

1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É —Å –ø–æ–ª–µ–º id PRIMARY KEY –∏ –Ω–∞–±–æ—Ä–æ–º –ø–æ–ª–µ–π —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ NOT NULL.

```sql
CREATE TABLE urev_t3_constrain (
    id int PRIMARY KEY,
  f1 int NOT NULL,
  f2 varchar NOT NULL
);

INSERT INTO urev_t3_constrain (id, f1, f2) VALUES (1, 15, 'ch'); 
INSERT INTO urev_t3_constrain (id, f1, f2) VALUES (2, -150, 'pg'); 
INSERT INTO urev_t3_constrain (id, f1, f2) VALUES (3, 373, 'gp'); 
```

2. –í—Å—Ç–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Å—Ç–∞–≤–∏—Ç—å NULL –≤ –ø–æ–ª–µ id –∏ –¥—Ä—É–≥–∏–µ –ø–æ–ª—è —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ NOT NULL.

```sql
INSERT INTO urev_t3_constrain (id) VALUES (NULL); 
```

–ü–æ–ª—É—á–∞–µ–º –æ—à–∏–±–∫—É:
```
ERROR:  null value in column "id" violates not-null constraint  (seg0 10.129.0.32:6000 pid=598245)
DETAIL:  Failing row contains (null, null, null).
```

3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Å—Ç–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –≤ –ø–æ–ª–µ id.

```sql
INSERT INTO urev_t3_constrain (id, f1, f2) VALUES (1, -90, 'sqlite3'); 
```

–ü–æ–ª—É—á–∞–µ–º –æ—à–∏–±–∫—É:
```
ERROR:  duplicate key value violates unique constraint "urev_t3_constrain_pkey"  (seg4 10.129.0.15:6001 pid=616174)
DETAIL:  Key (id)=(1) already exists.
```

4. –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `\d+ urev_t3_constrain`

![detailed_urev_t3_constrain.png](..%2Fimg%2Fdetailed_urev_t3_constrain.png)

5. –ù–∞–π–¥–∏—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–Ω–æ–π –≤–∞–º–∏ —Ç–∞–±–ª–∏—Ü—ã –≤ —Ç–∞–±–ª–∏—Ü–µ pg_constraint.

![conname.png](..%2Fimg%2Fconname.png)

contype = 'p' - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞

6. –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è `\d+ urev_t3_constrain_pkey`

![detailed_pkey_constrain.png](..%2Fimg%2Fdetailed_pkey_constrain.png)