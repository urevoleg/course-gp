# –§–∏–∑–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö –∏ DDL

## –°—É—â–Ω–æ—Å—Ç–∏

1. **–ò–Ω—Å—Ç–∞–Ω—Å** - –Ω–∞–±–æ—Ä –ø—Ä–æ–≥—Ä–∞–º–º, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å –ë–î
2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - –Ω–∞–±–æ—Ä —Ç–∞–±–ª–∏—Ü —Å –¥–∞–Ω–Ω—ã–º–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π, —Ñ—É–Ω–∫—Ü–∏–π –∏ –¥—Ä—É–≥–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤

–û–¥–∏–Ω –∏–Ω—Å—Ç–∞–Ω—Å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ë–î. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∏–∑ –æ–¥–Ω–æ–π –ë–î –≤ –¥—Ä—É–≥—É—é –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ

–°–∏–Ω—Ç–∞–∫—Å–∏—Å —Å–æ–∑–¥–∞–Ω–∏—è –Ω–µ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –æ—Ç Postgres

3. **–°—Ö–µ–º–∞** - –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏–º–µ–Ω, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã: —Ç–∞–±–ª–∏—Ü—ã, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è, —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö, —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
–ò–º–µ–Ω–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –æ–¥–Ω–æ–π —Å—Ö–µ–º–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã, –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ö–µ–º–∞—Ö –º–æ–≥—É—Ç –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏.
4. **–†–æ–ª—å** - —Å—É—â–Ω–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä–∞—è –º–æ–¥–µ—Ç –≤–ª–∞–¥–µ—Ç—å –æ–±—ä–µ–∫—Ç–∞–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –º–µ—Ç—å –µ—ë –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏. 
–†–æ–ª—å –º–æ–∂–µ—Ç —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å—Å—è –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –≥—Ä—É–ø–ø–∞ –∏–ª–∏ –æ–±–∞. –†–æ–ª–∏ —è–≤–ª—è—é—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ –¥–ª—è –≤—Å–µ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞

–ò–º–µ–Ω–∞ –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∫ —Ä–µ–≥–∏—Å—Ç—Ä—É: –æ–±—Ä–∞—â–µ–Ω–∏–µ

```sql
SELECT * FROM table; —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ SELECT * FROM TABLE;
```
–ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–æ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, —Ç–æ –∏–º–µ–Ω–∞ –∑–∞–∫–ª—é—á–∞—é—Ç—Å—è –≤ –∫–∞–≤—ã—á–∫–∏, `"table" != "TABLE"`

## –î–æ—Å—Ç—É–ø –∫ –æ–±—ä–µ–∫—Ç–∞–º

- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–º–µ–Ω–∏ —Å—Ö–µ–º–∞ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–µ—Ñ–∏–∫—Å–∞ 
```sql
SELECT * FROM stg.table;
```
- —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—É—Ç–∏ –ø–æ–∏—Å–∫–∞ `search_path` - —É–∫–∞–∑–∞–Ω–∏–µ –Ω—É–∂–Ω–æ–π —Å—Ö–µ–º—ã, –≤ –∫–æ—Ç–æ—Ä–æ–π –∏—Å–∫–∞—Ç—å –Ω—É–∂–Ω—ã–π –æ–±—ä–µ–∫—Ç

```sql
SELECT search_path; -- –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

SET search_path TO schema_name1 [, schema_name2, ....] -- –∑–∞–¥–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ
```
‚òùÔ∏è–∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—É—Ç–∏ –ø–æ–∏—Å–∫–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏


### ‚úçÔ∏è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 1

–°–æ–∑–¥–∞–≤–∞–ª–∏ —Ç–∞–±–ª–∏—Ü—ã –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ö–µ–º–∞, –º–µ–Ω—è–ª–∏ `search_path` –∏ —Å–º–æ—Ç—Ä–µ–ª–∏ –∫–∞–∫ —Å–µ–±—è –≤–µ–¥—É—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü.

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ Postgres —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å—Ö–µ–º—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä:
- pg_catalog
- information_schema
- pg_aoseg - —Å–ª—É–∂–µ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∞–±–ª–∏—Ü–∞—Ö append_optimized
- pg_toast - —Ö—Ä–∞–Ω–∏—Ç –æ–±—ä–µ–∫—Ç—ã, —Ä–∞–∑–º–µ—Ä –∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–µ–≤—ã—à–∞–µ—Ç —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é 32–ö–ë)
- pg_bitmapindex - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ bitmap-–∏–Ω–¥–µ–∫—Å–∞—Ö
- gp_toolkit - –æ–±—ä–µ–∫—Ç—ã, –Ω–µ–æ—å—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö —Å–∏—Å—Ç–µ–º—ã–Ω—Ö –º–µ—Ç—Ä–∏–∫

## –¢–∞–±–ª–∏—Ü—ã: –≤–∏–¥—ã, –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏—è –∏ —Å–∂–∞—Ç–∏–µ

### –î–∏—Å—Ç—Ä–∏–±—É—Ü–∏—è

![data-distribution.png](..%2Fimg%2Fdata-distribution.png)

–ö–æ–Ω—Ü–µ–ø—Ü–∏—è –ú–†–† - —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏, –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏–≤–∞–Ω–∏—è –∏ —É—Å–∫–æ—Ä–µ–Ω–∏—è –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏.
–¢–∞–∫–æ–π –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–ª–∏ **—à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ** –∏–ª–∏ **–¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏—è** . –î–ª—è GreenPlum –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏—è

–í–ê–ñ–ù–û: —É GP –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–ø–∏–π –¥–∞–Ω–Ω—ã—Ö —à–∞—Ä–¥–∞ –Ω–∞ –æ–¥–Ω–æ–º —Å–µ–≥–º–µ–Ω—Ç–µ, –ø–æ—ç—Ç–æ–º—É –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∏–º–µ–µ—Ç –≤—Å–µ–≥–æ 2 –∑–Ω–∞—á–µ–Ω–∏—è:
- 1 - –±–µ–∑ –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- 2 - —Å –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º (–ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é –≤ Managed Service for GP)

–î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏:
1. –î–∏—Å—Ç—Ä–∏–±—É—Ü–∏—è –ø–æ –∫–ª—é—á—É üîë (DISTRIBUTED BY):
 - –ö–ª—é—á –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏ –º–æ–∂–µ—Ç —Å–æ—Å—Ç–æ—è—Ç –∏–∑ 1 –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª–µ–π
 - –∫–ª—é—á –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏ –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –≤—ã—Å–æ–∫—É—é –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å - —á–∏—Å–ª–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
 - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–∞ –≤—ã–±–∏—Ä–∞—Ç—å –ø–æ–ª—è —Å JOIN
 - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ –±–æ–ª–µ–µ 3-–ø–æ–ª–µ–π

–ü—Ä–∏–º–µ—Ä:
```sql
CREATE TABLE t1 (
    id int,
    field1 String,
    ....
)
DISTRIBUTED BY (id, field1)
```

2. –°—É—á–∞–π–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (DISTRIBUTED RANDOMLY):
 - –µ—Å–ª–∏ –Ω–µ —É–¥–∞—ë—Ç—Å—è –≤—ã–±—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–π –∫–ª—é—á —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, —Ö–æ—Ä–æ—à–∏–º –≤–∞—Ä–∏–∞–Ω—Ç–æ–º –±—É–¥–µ—Ç —Å–ª—É—á–∞–π–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ
–ø—Ä–∏–Ω—Ü–∏–ø—É Round-Robin

3. –†–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏—è (DISTRIBUTED RANDOMLY):
 - –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ–≥–º–µ–Ω—Ç–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ–ª–Ω–∞—è –∫–æ–ø–∏—è –¥–∞–Ω–Ω—ã—Ö (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ —Ä–∞–∑–º–µ—Ä —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –ö–†–ê–¢–ù–û). –¢–∞–∫–æ–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–ª–æ–≤–∞—Ä–µ–π –∏ –Ω–µ–±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü

–°–∫–æ—Ä–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ = —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ —Å–∞–º–æ–º –º–µ–¥–ª–µ–Ω–Ω–æ–º —Å–µ–≥–º–µ–Ω—Ç–µ -> –ø–æ—ç—Ç–æ–º—É **–í–´–ë–û–† –ö–õ–Æ–ß–ê –î–ò–°–¢–†–ò–ë–£–¶–ò–ò –∫—Ä–∞–π–Ω–µ –í–ê–ñ–ï–ù**

–ö–ª—é—á –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏ –º–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å, –¥–ª—è —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã:
```sql
ALTER TABLE stg.table SET DISTRIBUTED BY (new_key); -- –∑–∞–º–µ–Ω–∞ –∫–ª—é—á–∞
ALTER TABLE stg.table SET WITH (REORGANIZE=true); -- –ø–µ—Ä–µ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã, –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –¥–æ–≤–æ–ª—å–Ω–æ –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
```

------------------------
## –¢–∞–±–ª–∏—Ü—ã –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É —Å–ø–æ—Å–æ–±—É —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–∏—Å–∫–µ

### HEAP

![heap-table.png](..%2Fimg%2Fheap-table.png)

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –ø—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–Ω–∞—è –∏–∑ Postgres
- —Å–æ–∑–¥–∞–µ—Ç –Ω–∞–∏–º–µ–Ω—å—à–µ–µ –∫–æ–ª-–≤–æ —Ñ–∞–π–ª–æ–≤ –Ω–∞ –¥–∏—Å–∫–µ
- –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ–≥–º–µ–Ω—Ç–µ –∑–∞–ø–∏—Å–∏ —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤ —Ñ–∞–π–ª
- –∫–æ–ª-–≤–æ —Ñ–∞–π–ª–æ–≤ –º–æ–∂–µ—Ç —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å—Å—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ 1–ì–ë –∏–ª–∏ –ø—Ä–∏ —Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª–∏–Ω—ã (VARCHAR)
- –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (row-oriented)
- —Å–∂–∞—Ç–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ
- —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –ø—Ä–∏ `CREATE TABLE` –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø—Ü–∏–π

–ö–µ–π—Å—ã:
- —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –∫–µ–π—Å—ã (–º–Ω–æ–≥–æ DELETE\UPDATE\INSERT)
- –¥–ª—è –º–∞–ª—ã—Ö —Ç–∞–±–ª–∏—Ü –¥–æ 1–ì–ë

### APPEND-OPTIMIZED-—Ç–∞–±–ª–∏—Ü—ã

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –Ω—É–∂–Ω—ã –¥–ª—è —Å–∂–∞—Ç–∏—è –¥–∞–Ω–Ω—ã—Ö - **–ì–õ–ê–í–ù–ê–Ø –û–°–û–ë–ï–ù–ù–û–°–¢–¨**
- –∏–º–µ—é—Ç —Å–ª–æ–∂–Ω—É—é –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –∫–∞–∫ row-oriented, —Ç–∞–∫ –∏ column-oriented. –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã. –ü–æ –¥–µ—Ñ–æ–ª—Ç—É: **row-oriented**

–í—ã–±–æ—Ä —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –±–ª–æ–∫–µ WITH:

```sql
CREATE TABLE t1 (
    id int,
    field1 String,
    ....
)
DISTRIBUTED RANDOMLY
WITH (appendoptimized=TRUE, orientation=COLUMN);  
```

–î–µ—Ç–∞–ª–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–∞ —Ä–∏—Å:

![append-optimized-table.png](..%2Fimg%2Fappend-optimized-table.png)


–ö–µ–π—Å—ã:
- —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ –∏ –±–æ–ª—å—à–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ —Ç–∞–±–ª–∏—Ü - –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —Å–∂–∞—Ç–∏–µ –±—É–¥—É—Ç –ø—Ä–µ–≤—ã—â–∞—é—Ç –≤—ã–≥–æ–¥—É –æ—Ç —Å–∂–∞—Ç–∏—è
- –º–∞—Å—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–µ–π—Å—ã (–∫—Ä—É–ø–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ batch + –¥–æ—Å—Ç—É–ø –Ω–∞ —á—Ç–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–º–æ—â–∏ SELECT)

--------------------------------
## –°–∂–∞—Ç–∏–µ

![compression-meme.png](..%2Fimg%2Fcompression-meme.png)

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –∏ —Å—Ç–µ–ø–µ–Ω–µ–π —Å–∂–∞—Ç–∏—è (1-19)
- —Å–∂–∞—Ç–∏—è –∑–∞–¥–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω–æ –ø—Ä–∏ –ø–æ–º–æ—â–∏ `ALTER`
- –ø—Ä–∏ column-oriented —Ö—Ä–∞–Ω–µ–Ω–∏–∏: —Ä–∞–∑–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –∏ —Å—Ç–µ–ø–µ–Ω–∏ —Å–∂–∞—Ç–∏—è
- —Å–∂–∞—Ç–∏–µ —ç–∫–æ–Ω–æ–º–∏—Ç –¥–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∑–∞ —Å—á–µ—Ç CPU
- –Ω–µ–º–Ω–æ–≥–æ –∑–∞–º–µ–¥–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω–Ω—ã—Ö –∏–∑-–∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CPU –ø—Ä–∏ —Å–∂–∞—Ç–∏–∏
- —á—Ç–µ–Ω–∏–µ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Å–∂–∞—Ç–∏—è (–º–µ–Ω–µ–µ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç CPU)

–ê–ª–≥–æ—Ä–∏—Ç—ã —Å–∂–∞—Ç–∏—è: **zstd** (–Ω–æ–≤—ã–π/—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è), **zlib**(—Å–æ—Ö—Ä–∞–Ω–µ–Ω –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏), **rle_type**(—Ç–æ–ª—å–∫–æ
–¥–ª—è column-oriented –∏ –¥–ª—è —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã—Ö —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤/date/time)

**–õ—É—á—à–µ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ: zstd\zlib –ø—Ä–∏ —Å—Ç–µ–ø–µ–Ω —Å–∂–∞—Ç–∏—è 1-2, rle_type —Å–∂–∞—Ç–∏–µ 2**

–ü—Ä–∏–º–µ—Ä:
```sql
CREATE TABLE t1 (
    id int,
    field1 String,
    ....
)
WITH (appendoptimized=TRUE, orientation=COLUMN, 
    compresstype=zstd, compresslevel=2)
DISTRIBUTED by (id);  
```

–ß–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞—é—â–∏–µ—Å—è –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –ø–æ–∫–∞–∑–∞–Ω—ã –≤ —Ç–∞–±–ª–∏—Ü–µ:

![freq-cases-typetable-compress.png](..%2Fimg%2Ffreq-cases-typetable-compress.png)

------------------------------
## –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –∂–∏–≤—É—Ç –≤ —Ä–∞–º–∫–∞—Ö —Å–µ—Å—Å–∏–∏ (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ–º –æ—Ç –Ω–µ—ë)
- —Å–æ–∑–¥–∞–Ω–∏–µ = —É–∫–∞–∑–∞–Ω–∏–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ `CREATE TEMPORARY TABLE` (–ø–æ–¥–¥–µ—Ä–∂–∏–∞—é—Ç—Å—è –≤—Å–µ —à—Ç—É–∫–∏: –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏—è, —Ç–∏–ø—ã —Ç–∞–±–ª–∏—Ü, —Å–∂–∞—Ç–∏–µ)
- –∏–º—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –ø–∏—à–µ—Ç –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è —Å—Ö–µ–º—ã (–æ–Ω–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–π —Å—Ö–µ–º–µ), —Å—Ö–µ–º–∞ —Ç–æ–∂–µ —è–≤–ª—è–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∏ —É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å–µ—Å—Å–∏–∏
- –º–æ–∂–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ü–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–∏ –ø–æ–º–æ—â–∏ –±–ª–æ–∫–∞ `ON COMMIT`:
  - `ON COMMIT DELETE ROWS` - –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –≤ –∫–æ–Ω—Ü–µ –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  - `ON COMMIT DROP` - –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∞ –≤ –∫–æ–Ω—Ü–µ –±–ª–æ–∫–∞ —Ç–µ–∫—É—â–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

------------------------------
## –ù–µ–∂—É—Ä–Ω–∞–ª–∏—Ä—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã

![turbo-nonjournal-table.png](..%2Fimg%2Fturbo-nonjournal-table.png)

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –Ω–∏—á–µ–≥–æ –∫—Ä–æ–º–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ (–¥–∞–Ω–Ω—ã–µ –ø–∏—à—É—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ —Ç–∞–±–ª–∏—Ü—É, –º–∏–Ω—É—è WAL)
- —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏:
  - –Ω–µ—Ç WAL
  - –Ω–µ—Ç –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è
  - –ø—Ä–∏ —Å–±–æ–µ/—Ä–µ—Å—Ç–∞—Ä—Ç–µ —Ç–∞–±–ª–∏—Ü–∞ –±—É–¥–µ—Ç –ø—É—Å—Ç–æ–π, —Ö–æ—Ç—è —Å–∞–º–∞ –æ–Ω–∞ —Å–æ–∑–¥–∞—Å—Ç—Å—è
- —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ `CREATE UNLOGGED TABLE`
- –æ–ø—Ü–∏–∏ –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏/—Å–∂–∞—Ç–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã

–ö–µ–π—Å—ã:
- –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∏—Ç—Ä–∏–Ω—ã, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –Ω—É–∂–Ω—ã–µ —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –≤–ª–∏—Ç—å –∏—Ö –≤ —Ç–∞–±–ª–∏—Ü—É)

---------------------------
## –í–Ω–µ—à–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –Ω–µ —Ö—Ä–∞–Ω—è—Ç –¥–∞–Ω–Ω—ã–µ
- –æ–ø–∏—Å—ã–≤–∞—é—Ç —Ñ–æ—Ä–º–∞—Ç –∏ –ø—É—Ç—å –∫ –¥–∞–Ω–Ω—ã–º, –Ω–∞—Ö–æ–¥—è—â–∏–º—Å—è –≤–æ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–∞–π–ª—ã –∏–ª–∏ –¥—Ä—É–≥–∏–µ –°–£–ë–î)

–°–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ `EXTERNAL` —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–∏–ø–∞ —Ç–∞–±–ª–∏—Ü—ã:
- `READABLE`
- `WRITEABLE`

---------------------------

### ‚úçÔ∏è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 2: –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Å–∂–∞—Ç–∏—è

1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º zstd —Å —É—Ä–æ–≤–Ω–µ–º 2:

```sql
CREATE TABLE public.urev_t2_compress (
    id int,
    category int,
    value float
)
WITH (appendoptimized=TRUE,
    compresstype=zstd, 
    compresslevel=2);
```

2. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –±–µ–∑ —Å–∂–∞—Ç–∏—è
```sql
CREATE TABLE public.urev_t2_nocompress (
    id int,
    category int,
    value float
)
WITH (appendoptimized=TRUE);
```

3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–º–∏ –æ–±–µ —Ç–∞–±–ª–∏—Ü—ã (100000+ —Å—Ç—Ä–æ–∫)

–°–∫—Ä–∏–ø—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏ [generate_data.sql](sql%2Fgenerate_data.sql)

4. –ß–µ–∫–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã —Ç–∞–±–ª–∏—Ü –ø—Ä–∏ –ø–æ–º–æ—â–∏ –Ω–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ [compare_table_size.sql](sql%2Fcompare_table_size.sql) üòú

![chapter2-compare-table-size.png](..%2Fimg%2Fchapter2-compare-table-size.png)

![surprise.png](..%2Fimg%2Fsurprise.png)

–£–¥–∏–≤–ª–µ–Ω—ã, ..... –Ω–µ—Ç, —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∂–∞—Ç–∏–µ –¥–∞–Ω–Ω—ã–µü§ò

